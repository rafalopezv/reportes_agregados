---
title: "Análisis sobre las temáticas de las postulaciones y su relación con PULSANTE"
subtitle: "Fondo de Respuesta Rápida"
author: "PULSANTE"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "metropolis", "metropolis-fonts", "assets/custom.css"]
    nature:
      # ratio: "16:9"
      ratio: "4:3"
      selfcontained: true
      # highlightStyle: solarized-light
      # highlightLines: true
      countIncrementalSlides: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
library(highcharter)
library(tidyverse)
library(magrittr)


bases <- list.files(recursive = T)
bases <- bases[grep("FRR/ciclo_", bases)]
bases <- bases[grep("xlsx", bases)]
bases <- bases[grep("Pulsante_ todas las propuestas FRR 2020", bases, invert = T)]

# ordenar
bases <- bases[c(1, 8, 9:15, 2:7)]

datos1 <- rio::import_list(bases[1], rbind = T)
datos2 <- rio::import_list(bases[2], rbind = T)
datos3 <- map(bases[3:15], rio::import) %>% map(., janitor::clean_names)
datos <- list(datos1, datos2)
datos <- c(datos, datos3)

# añadir columna de ciclo
for(i in 1:length(datos)) {
  datos[[i]] %<>%
    mutate(ciclo = i)
}

# temas por país
extraer <- c("tema",  "menciona_el_pais_o_paises_donde_se_realizara_el_proyecto_puedes_elegir_mas_de_un_pais", "ciclo")

map_dfr(datos[3:15], ~extract(., extraer)) %>% 
  rename(
    pais = menciona_el_pais_o_paises_donde_se_realizara_el_proyecto_puedes_elegir_mas_de_un_pais
  ) %>% 
  separate_rows(pais, sep = ",") -> temp


# temas ciclo 1
c1 <- rio::import("input/temas.csv") %>% 
  select(pais, tema) 

c1 %>% 
  separate_rows(pais) -> c1


c1 %>% 
  filter(
    pais != "El",
    pais != "y",
    pais != "Rica",
    pais != "Latinoamérica",
    pais != "Dominicana",
    pais != "España"
  ) -> c1


temp1 <- which(c1$pais == "Paragua")
c1[temp1, "pais"] <- "Paraguay" 

temp1 <- which(c1$pais == "Costa")
c1[temp1, "pais"] <- "Costa Rica" 

temp1 <- which(c1$pais == "República")
c1[temp1, "pais"] <- "República Dominicana" 

temp %<>% 
  bind_rows(., c1) 

temp1 <- which(temp$pais == "Bolívia")
temp[temp1, "pais"] <- "Bolivia" 

temp1 <- which(temp$pais == "Brazil")
temp[temp1, "pais"] <- "Brasil" 

temp1 <- which(temp$pais == "Haiti")
temp[temp1, "pais"] <- "Haití"

temp1 <- which(temp$pais == "Peru")
temp[temp1, "pais"] <- "Perú"

temp1 <- which(temp$pais == "Salvador")
temp[temp1, "pais"] <- "El Salvador"

temp1 <- which(temp$tema == "Transporte público")
temp[temp1, "tema"] <- "Ciudades"

temp1 <- which(temp$tema == "Violencia doméstica")
temp[temp1, "tema"] <- "Violencia de género"

temp1 <- which(temp$tema == "Violencia sexual")
temp[temp1, "tema"] <- "Violencia de género"

temp1 <- which(temp$tema == "Violencia sexual")
temp[temp1, "tema"] <- "Violencia de género"

temp1 <- which(temp$tema == "Equidad de género")
temp[temp1, "tema"] <- "Equidad de Género"

temp1 <- which(temp$tema == "Derechos de pueblos indígenas")
temp[temp1, "tema"] <- "Derechos pueblos indígenas"

# agragdor
agregado <- rio::import("input/temas_grandes_1.csv") %>% 
  janitor::clean_names() %>% 
  select(1:3)

temp %>% 
  merge(., agregado, all.x = T) %>% 
  filter(!is.na(indicadores_pulsante)) %>% 
  separate_rows(indicadores_pulsante, sep = ",") %>% 
  separate_rows(sub_indicadores_pulsante, sep = ",") %>% 
  mutate_if(is.character, trimws) -> temp

temp1 <- which(temp$indicadores_pulsante == "Otro")
temp[temp1, "indicadores_pulsante"] <- "Otros (fuera de PULSANTE)"
temp[temp1, "sub_indicadores_pulsante"] <- "Otros (fuera de PULSANTE)"

```

class: clear, right, bottom
background-image: url("img/pulsante.jpg")
background-size: cover

# Objetivo de la presentación

---

# Objetivo de la presentación

Determinar a partir de las casi 500 aplicaciones al FRR:

- Si hay temas recurrentes de interés regional
- Si los temas de interés son específicos para cada país
- Coomo se distribuyeron las postulaciones en las áreas de interés de PULSANTE
- Alimentar las decisiones de los próximos pasos


---

# Marco del análisis

- Casi 500 propuestas presentadas
- 55 temas diferentes, agregados en:
  + 5 dimensiones que reflejan el trabajo de PULSANTE
  + 10 indicadores, que detallan las dimensiones de trabajo de PULSANTE 
- 20 países postulantes
- 15 semanas

---

# Dimensiones e indicadores de PULSANTE

- Libertad de información y libertad de expresión
  + Acceso a información
  + Libertad de expresión
  + Libertad de medios de comunicación
  + Libertad en internet

- Derecho de asamblea y asociación
  + Derecho de asociación
  + Autonomía de las organizaciones sociales
  + Financiamiento de organizaciones sociales

- Participación ciudadana y/o elecciones libres y justas
  + Participación ciudadana
  + Incidencia ciudadana
  
- No discriminación/inclusión
  + Derechos de mujeres
  + Derechos de minorías
  + Derechos de grupos marginalizados
  
- Protección de derechos humanos y el estado de derecho
  + Derechos humanos e imperio de la ley

---
# Temas de las postulaciones

```{r, echo = F, include = T}
temp %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) %>% 
  rename(
    agregado = sub_indicadores_pulsante
  ) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) %>% 
  hc_title(text = "El área representa la proporción de los indicadores de PULSANTE") %>% 
  hc_subtitle(text = "Puede hacer click sobre cada rectángulo en letras grandes para mayores detalles<br>Las letras grandes representan a los indicadores de PULSANTE agregados y las pequeñas a los temas de las postulaciones ") 
  
```
---

# Temas de las postulaciones

De los siete grandes grupos/temas el de "Derechos humanos e imperio de la Ley" concentra un cuarto de las postulaciones. 
<br>
<br>
¿Cómo se distribuyen estos temas en los 20 países, hay alguna tendencia?

---
# Indicadores de Pulsante vs Países
```{r, echo = F, include = T}
temp %>% 
  group_split(pais) %>% 
  map(., ~group_by(., pais) %>% 
        count(indicadores_pulsante) %>% 
        mutate(
          pro = prop.table(n)*100
        ) %>% 
        mutate_if(is.numeric, round, 1)) %>% 
  bind_rows() %>% 
  rename(agregado = indicadores_pulsante) -> temp2


hchart(
  temp2, 
  "heatmap", 
  hcaes(
    x = pais,
    y = agregado, 
    value = pro
  )
) %>% 
  hc_colorAxis(
    stops = color_stops(4, c("#222438", "#E07A5F", "#F2CC8F", "#BBEAD3"))
  ) %>% 
  hc_yAxis(mayorGridLineWidth = 2, gridLineColor = "black", title = list(text = "Temas agregados")) %>% 
  hc_xAxis(mayorGridLineWidth = 2,  gridLineColor = "black", 
           title = list(text = NULL)) %>% 
  hc_chart(backgroundColor="white", borderColor = "transparent", 
           style=list(fontFamily = "Open Sans", fontSize = 12)) %>% 
  hc_tooltip(enabled = T, valueDecimals = 2, borderWidth = 0.01, 
             backgroundColor = "white",  style = list(fontFamily = "Open Sans"),
             pointFormat=paste("<b>{point.pais}</b> concentra el <b>{point.pro}</b> % de sus aplicaciones en <b>{point.agregado}</b>"),
             headerFormat = "") %>% 
  hc_size(height = 550) %>% 
  hc_title(text = "Pase el mouse sobre cada rectángulo para mayores detalles") %>% 
  hc_subtitle(text = "Todos los temas por país han sido porcentualizados") 

```
---

# Grandes temas vs Países

- Derechos de mujeres ha tenido al menos una postulación de todos los países. ¿Concidencia regional?: SI.

- Derechos humanios e imperio de la ley  es el segundo indiocador de concurrencia regional

- Libertad de expresión es el indicador menos concurrido regionalmente

- ¿Los temas específicos tendrán alguna congregación regional?

---

# Temas específicos vs Países

```{r, echo = F, include = T}
temp %>% 
  group_split(pais) %>% 
  map(., ~group_by(., pais) %>% 
        count(sub_indicadores_pulsante) %>% 
        mutate(
          pro = prop.table(n)*100
        ) %>% 
        mutate_if(is.numeric, round, 1)) %>% 
  bind_rows() %>% 
  rename(tema = sub_indicadores_pulsante)-> temp3


hchart(
  temp3, 
  "heatmap", 
  hcaes(
    x = pais,
    y = tema, 
    value = pro
  )
) %>% 
  hc_colorAxis(
    stops = color_stops(4, c("#222438", "#E07A5F", "#F2CC8F", "#BBEAD3"))
  ) %>% 
  hc_yAxis(mayorGridLineWidth = 2, gridLineColor = "black", title = list(text = "Temas detallados")) %>% 
  hc_xAxis(mayorGridLineWidth = 2,  gridLineColor = "black", 
           title = list(text = NULL)) %>% 
  hc_chart(backgroundColor="white", borderColor = "transparent", 
           style=list(fontFamily = "Open Sans", fontSize = 12)) %>% 
  hc_tooltip(enabled = T, valueDecimals = 2, borderWidth = 0.01, 
             backgroundColor = "white",  style = list(fontFamily = "Open Sans"),
             pointFormat=paste("<b>{point.pais}</b> concentra el <b>{point.pro}</b> % de sus aplicaciones en <b>{point.tema}</b>"),
             headerFormat = "") %>% 
  hc_size(height = 550) %>% 
  hc_title(text = "Pase el mouse sobre cada rectángulo para mayores detalles") %>% 
  hc_subtitle(text = "Todos los temas por país han sido porcentualizados") 
```

---

# Temas específicos vs Países

- Tres temas específicos de 55 tienen coherencia regional:
- Equidad de género
- Procesos electorales
- Corrupción
---

# Conclusiones

- Género como gran tema, equidad de género como tema particular pueden pensarse desde una lógica regional

- Existe coherencia regional en temas como corrupción y procesos electorales

- De forma menor, el gran tema de violencia congrega a más de la mitad de los países

- Los temas de las postulaciones son orientativos. Sin embargo. se debe pensar en que temas que no se han tratado son de relevancia social, económica y política en el futuro inmediato de la región. Por ejemplo: digitalización de servicios públicos dada la nueva forma de interacción Sociedad-Estado

---
# Argentina
```{r, echo = F, include = T}
temp %>%
  filter(pais == "Argentina") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```
---

# Bolivia

```{r, echo = F, include = T}

temp %>%
  filter(pais == "Bolivia") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```
---

# Brasil

```{r, echo = F, include = T}

temp %>%
  filter(pais == "Brasil") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```

---

# Chile

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Chile") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```

---

# Colombia

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Colombia") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```


---

# Ecuador

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Ecuador") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```


---

# El Salvador

```{r, echo = F, include = T}
temp %>%
  filter(pais == "El Salvador") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```

---

# Guatemala

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Guatemala") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```


---

# Haití

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Haití") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```


---

# Honduras

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Honduras") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```


---

# México

```{r, echo = F, include = T}
temp %>%
  filter(pais == "México") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```

---

# Nicaragua

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Nicaragua") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```


---

# Panamá

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Panamá") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```



---

# Paraguay

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Paraguay") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```


---

# Perú

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Perú") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```

---

# República Dominicana

```{r, echo = F, include = T}
temp %>%
  filter(pais == "República Dominicana") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```

---

# Uruguay

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Uruguay") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```

---

# Venezuela

```{r, echo = F, include = T}
temp %>%
  filter(pais == "Venezuela") %>% 
  count(sub_indicadores_pulsante, tema) %>% 
  rename(
    agregado = sub_indicadores_pulsante,
  ) %>% 
  arrange(desc(n)) %>% 
  remove_missing() %>% 
  mutate(prop = prop.table(n)*100) -> temp1

# colores
cols <- rep(c("#E01F52", "#C6A659", "#06D6A0", "#466B77", "#073B4C", 
              "#D8B970", "#5FA1B7", "#118AB2", "#BAAB89", "#1E4D5C", 
              "#2C6E49", "#E07A5F", "#3D405B", "#81B29A", "#63585F", 
              "#B4B5BA", "#261F23", "#575D7C", "#9194C6", "#75184D"), 3)


temp1 %>% 
  select(agregado) %>% 
  unique() %>% 
  mutate(
    color = cols[1:nrow(.)]
  ) %>% 
  left_join(., temp1) -> temp1
  
  
lvl_opts <-  list(
  list(
    level = 1,
    borderWidth = 0,
    borderColor = "transparent",
    dataLabels = list(
      enabled = TRUE,
      align = "left",
      verticalAlign = "top",
      style = list(fontSize = "16px", textOutline = FALSE, color = "black")
    )
  ),
  list(
    level = 2,
    borderWidth = 0,
    borderColor = "transparent",
    colorVariation = list(key = "brightness", to = 0.250),
    dataLabels = list(
      enabled = T,
      align = "right",
      verticalAlign = "bottom",
      style = list(fontSize = "9px", textOutline = FALSE, color = "black", fontFamoly = "Open Sans Light")
      ),
    style = list(fontSize = "8px", textOutline = FALSE, color = "black")
  )
)

hchart(
  data_to_hierarchical(temp1, c(agregado, tema), prop, colors = cols),
  type = "treemap",
  levelIsConstant = T,
  allowDrillToNode = T,
  drillUpButton = list(
    text = "< Volver"
  ),
  levels = lvl_opts,
  tooltip = list(valueDecimals = 2)
) %>% 
  hc_chart(
    style = list(fontFamily = "Open Sans")
  ) %>% 
  hc_tooltip(backgroundColor = "white", borderWidth = 0.001, valueSuffix = "%") %>% 
  hc_size(height = 550) 
```




